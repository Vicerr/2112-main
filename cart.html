<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <link rel="stylesheet" href="css/main.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre&display=swap" rel="stylesheet">
  <script defer src="js/main.js"></script>
</head>

<body>
  <nav class="navigation">
    <div class="wrapper container">
      <div class="breakout">
        <div class="logo-container"><img src="assets/images/logo.png" alt=""></div>
        <div class="nav-misc" data-navigation-status="closed" id="nav-misc">
          <button id="close-navigation" onclick="toggleNav()">
            <div class="cross"></div>
          </button>
          <ul class="nav-items">
            <li><a class="nav-link" href="/">Home</a></li>

            <li><a class="nav-link" href="/products.html">Senators</a></li>
            <li><a class="nav-link hide" href="/checkout.html">Orders</a></li>
            <li><a class="nav-link hide" href="/cart.html">Cart</a></li>
            <li><a class="nav-link" href="/contact.html">Contact</a></li>
          </ul>
          <div class="actions">
            <a href="./cart.html" class="icon"><img src="assets/icons/save.svg" alt=""></a>
            <a href="./checkout.html" class="icon" data-counter="10"><img src="assets/icons/envelope.svg" alt=""></a href="">
          </div>
        </div>
        <button id="open-navigation" onclick="toggleNav()">
          <div class="bar"></div>
        </button>

      </div>

    </div>
  </nav>
  <main class="container">
    <div class="wrapper">
      <section class="cart--section">
        <div class="cart--card" id="cart-card-<%= item.item._id %>">
          <div class="cart--card--image-container"><img src="assets/images/img-8337-6680861cdabff.webp" alt=""></div>
          <div class="cart--card--details">
            <p class="cart--item-name">product name</p>
            <div class="cart--item-specification">
              <p>Quantity: <span class="display-order-count" id="display-order-count-<%= item.item._id %>"></span> 1</span></p>
              <p>Size: <span>M</span></p>
              <!-- <p>Color: <span>blue</span></p> -->
            </div>
            <p class="cart--item-price">Price: &#8358 400

            </p>
            <div class="item--order-actions">
              <div class="order-count cart">
                <button class="decrement" data-item-id="<%= item.item._id %>" id="decrement-<%= item.item._id %>"> - </button>
                <p>
                  <span class="display-order-count" id="display-order-count-quantity-<%= item.item._id %>">1</span>
                </p>
                <button class="increment" data-item-id="<%= item.item._id %>" id="increment-<%= item.item._id %>"> + </button>
              </div>
            </div>
          </div>
          <form action="/orders/<%= item.item._id %>/delete?_method=DELETE" method="POST" class="delete-item-form">
            <button type="submit" class="delete-item">x</button>
          </form>
        </div>
        <div class="cart--card">
          <div class="cart--card--image-container"><img src="assets/images/img-8336-6680861d35809.webp" alt=""></div>
          <div class="cart--card--details">
            <p class="cart--item-name">Claudette Corset Dress in White</p>
            <div class="cart--item-specification"></div>
            <p class="cart--item-price">$$333</p>
          </div>
          <a href="" class="delete-item">x</a>
        </div>
        <div class="cart--card">
          <div class="cart--card--image-container"><img src="assets/images/img-8336-6680861d35809.webp" alt=""></div>
          <div class="cart--card--details">
            <p class="cart--item-name">Claudette Corset Dress in White</p>
            <div class="cart--item-specification"></div>
            <p class="cart--item-price">$$333</p>
          </div>
          <a href="" class="delete-item">x</a>
        </div>
        <div class="cart--card">
          <div class="cart--card--image-container"><img src="assets/images/img-8336-6680861d35809.webp" alt=""></div>
          <div class="cart--card--details">
            <p class="cart--item-name">Claudette Corset Dress in White</p>
            <div class="cart--item-specification"></div>
            <p class="cart--item-price">$$333</p>
          </div>
          <a href="" class="delete-item">x</a>
        </div>

      </section>
      <section class="cart--summary">
        <div class="first-details">
          <p><span>Total Price </span><span><span>&#8358</span> <span> 400</span></span></p>
          <p><span>Discount</span> <span>£0</span></p>
          <p><span>Estimated Delivery Fee</span> <span>free</span></p>
        </div>
        <div class="second-details">
          <p><span>Total Price:</span><span><span>&#8358</span> <span>400</span></span></p>
          <p class="text-secondary"><span>Savings Applied</span> <span>£3300</span></p>
          <!-- <form action="/checkout" method="post"> -->
          <button style="padding: 0;" type="submit"><a style="display: block; text-decoration: none; color: white; padding-block: 1em;" href="/checkout" class="cart-btn">Checkout</a></button>
          <!-- </form> -->
          <form action="/orders/clear-orders" method="post" id="clear-orders-form">
            <button type="submit" id="clear-orders-button" class="cart-btn">Clear Orders</button>
          </form>
        </div>
      </section>
    </div>
  </main>

  <footer class="full-width">
    <div class="footer-wrapper">
      <div class="logo"><img src="assets/images/logo.png" alt=""></div>
      <ul class="quick-links">
        <li><a href="">Home</a></li>
        <li><a href="">Brands</a></li>
        <li><a href="">Collection</a></li>
        <li><a href="">About Us</a></li>
      </ul>
      <ul class="quick-links">
        <li>Contact Us</li>
        <li><a href="tel:">4949494949</a></li>
        <li><a href="mailto:">something@gmail.com</a></li>
        <li><a href="https://">website.com</a></li>
      </ul>
      <div class="socials">
        <p>All Rights Reserved 2024</p>
        <ul>
          <li class="icons"><a href=""><img src="assets/icons/tiktok.svg" loading="lazy" alt=""></a></li>
          <li class="icons"><a href=""><img src="assets/icons/instagram.svg" loading="lazy" alt=""></a></li>
          <li class="icons"><a href=""><img src="assets/icons/twitter.svg" loading="lazy" alt=""></a></li>
        </ul>
      </div>
    </div>
  </footer>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const updateQuantity = async (itemId, action) => {
        const quantitySpan = document.getElementById(`display-order-count-${itemId}`);
        let currentQuantity = parseInt(quantitySpan.innerText);
        const quantityUpdate = document.getElementById(`display-order-count-quantity-${itemId}`);
        let currentQuantityUpdate = parseInt(quantityUpdate.innerText);

        if (action === 'increment') {
          currentQuantity += 1;
          currentQuantityUpdate += 1;
        } else if (action === 'decrement') {
          currentQuantity = currentQuantity > 1 ? currentQuantity - 1 : 1;
          currentQuantityUpdate = currentQuantityUpdate > 1 ? currentQuantityUpdate - 1 : 1;
        }

        const response = await fetch(`/orders/update-quantity`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            itemId,
            newQuantity: currentQuantity,
          }),
        });

        const data = await response.json();
        if (data.success) {
          quantitySpan.innerText = data.newQuantity;
          quantityUpdate.innerText = data.newQuantity;
          document.querySelector('.cart--summary .first-details span:last-child span:last-child').innerText = data.newTotal.toFixed(2);
          document.querySelector('.cart--summary .second-details span:last-child span:last-child').innerText = data.newTotal.toFixed(2);
        } else {
          alert('Failed to update quantity');
        }
      };

      document.querySelectorAll('.increment').forEach(button => {
        button.addEventListener('click', () => {
          const itemId = button.getAttribute('data-item-id');
          updateQuantity(itemId, 'increment');
        });
      });

      document.querySelectorAll('.decrement').forEach(button => {
        button.addEventListener('click', () => {
          const itemId = button.getAttribute('data-item-id');
          updateQuantity(itemId, 'decrement');
        });
      });
    });
  </script>
</body>

</html>